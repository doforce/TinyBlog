(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-11e4d056"],{"46c5":function(t,e,a){},"49d7":function(t,e,a){"use strict";a.r(e);var i=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("a-row",{staticClass:"editor-title"},[a("a-col",{attrs:{span:12}},[a("a-input",{attrs:{value:t.title,placeholder:"请输入文章标题"},on:{change:t.handleChangeTitle}})],1),a("a-col",{attrs:{span:1,offset:9}},[a("el-popover",{attrs:{placement:"bottom",title:"标签",trigger:"click"}},[a("LabelBind",{attrs:{activeLabels:t.activeLabels},on:{onTagsSelected:t.onTagsSelected}}),a("a-button",{attrs:{slot:"reference",icon:"tags",shape:"circle",type:"default"},slot:"reference"})],1)],1),a("a-col",{attrs:{span:2}},[a("a-button",{attrs:{icon:"check",type:"primary"},on:{click:t.publishArticle}},[t._v(t._s(t.publishDescription))])],1)],1),a("a-row",[a("mavon-editor",{ref:"md",staticClass:"editor-body",attrs:{placeholder:t.contentPlaceholder},on:{imgAdd:t.imgAdd},model:{value:t.content,callback:function(e){t.content=e},expression:"content"}})],1)],1)},s=[],l=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("div",{staticClass:"tag-group"},t._l(t.allTags,(function(e){return a("a-tag",{key:e.id,staticClass:"all-tags",attrs:{color:e.effect,type:e.type},on:{click:function(a){return t.onTagClick(e.id)}}},[t._v(t._s(e.label))])})),1),a("div",{staticClass:"tag-group"},[a("a-input",{staticClass:"add-tag",attrs:{placeholder:"添加标签",type:"text",size:"small",value:t.newTag},on:{change:t.handleInputChange,blur:t.handleInputBlur,keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.handleInputConfirm(e)}}})],1)])},c=[],n=a("8821"),r={name:"LabelBind",async created(){await this.getAllLabels()},data(){return{newTag:"",tagsDescription:"点击选择标签",allTags:[],selectedIds:[]}},props:["activeLabels"],watch:{selectedIds:function(t){this.$emit("onTagsSelected",t),console.log(this.selectedIds)},activeLabels:function(t){this.setActiveLabels(t)}},methods:{async handleInputBlur(){this.newTag=""},async handleInputConfirm(){if(""===this.newTag)return void this.$message.warning("标签不能为空");let t=await n["a"].addLabel(this.newTag);t.ok?(this.allTags.push({id:t.data.id,label:this.newTag,effect:"green"}),this.selectedIds.push(t.data.id)):this.$message.error("标签已存在")},onTagClick(t){for(let e of this.allTags)e.id===t&&(""===e.effect?(e.effect="green",this.selectedIds.push(e.id)):(e.effect="",this.selectedIds.splice(this.selectedIds.indexOf(e.id),1)))},async getAllLabels(){let t=await n["a"].getAllLabels();if(t.ok){let e=t.data.results;for(let t of e)t.effect="";this.allTags=e,this.tagsDescription="点击选择标签"}else this.tagsDescription="还没有创建标签呢"},setActiveLabels(t){console.log(t),this.activeLabels.length>0&&(this.allTags.forEach(t=>{this.activeLabels.forEach(e=>{e===t.id&&(t.effect="dark")})}),this.selectedIds=this.activeLabels)},handleInputChange(t){this.newTag=t.target.value}}},o=r,d=(a("ad0d"),a("5511")),u=Object(d["a"])(o,l,c,!1,null,"9fcb6c12",null),h=u.exports,p=a("0dcc"),g=a("d8d4"),b={name:"Editor",components:{LabelBind:h},async created(){this.articleId&&(await this.getArticle(),this.publishDescription="更新")},data(){return{articleId:this.$route.params.id,content:"",title:"",label_ids:[],contentPlaceholder:"开始写作吧",publishDescription:"发布",article:null,activeLabels:[],uploadAction:"/api/file/upload"}},methods:{async publishArticle(){console.log("publish article"),""!==this.title?""!==this.content?this.articleId?await this.editArticle():await this.addArticle():this.$message.warning("内容不能为空"):this.$message.warning("标题不能为空")},async editArticle(){let t=await g["a"].updateArticle(this.articleId,{title:this.title,content:this.content,label_ids:this.label_ids});t.ok?(this.$message.success("更新文章成功"),window.location.href="/post/".concat(this.articleId)):this.$message.error("更新文章出错")},async addArticle(){let t=await g["a"].addArticle({title:this.title,content:this.content,label_ids:this.label_ids});t.ok?(this.$message.success("发布文章成功"),window.location.href="/post/".concat(t.data.id)):this.$message.error("发布文章出错")},async getArticle(){let t=await g["a"].getArticle(this.articleId);t.ok&&(this.article=t.data,this.title=this.article.title,this.content=this.article.content,this.activeLabels=this.article.labels?this.article.labels.map(t=>t.id):[],console.log(this.activeLabels))},onTagsSelected(t){this.label_ids=t},async imgAdd(t,e){p["a"].upload(e,this.uploadAction).then(e=>{e.ok?this.$refs.md.$img2Url(t,`back:3000/${e.data.avatar}`):this.$message.error("上传失败")})},handleChangeTitle(t){this.title=t.target.value}}},f=b,w=(a("c212"),Object(d["a"])(f,i,s,!1,null,null,null));e["default"]=w.exports},8821:function(t,e,a){"use strict";a.d(e,"a",(function(){return s}));var i=a("0dcc");class s{static async addLabel(t){let e={url:"/api/label",data:{label:t}};return await i["a"].post(e)}static async getAllLabels(){let t={url:"/api/pub/labels"};return await i["a"].get(t)}}},ad0d:function(t,e,a){"use strict";var i=a("46c5"),s=a.n(i);s.a},c212:function(t,e,a){"use strict";var i=a("fc7b"),s=a.n(i);s.a},d8d4:function(t,e,a){"use strict";a.d(e,"a",(function(){return s}));var i=a("0dcc");class s{static async addArticle(t){let e={url:"/api/article",data:t};return await i["a"].post(e)}static async updateArticle(t,e){let a={url:"/api/article/".concat(t),data:e};return await i["a"].put(a)}static async getArticle(t){let e={url:"/api/pub/article/".concat(t)};return await i["a"].get(e)}static async getArticleList(t){let e=null;return e=t?{url:"/api/pub/articles/list",data:{label_id:t}}:{url:"/api/pub/articles/list"},await i["a"].get(e)}static async deleteArticle(t){return await i["a"].delete({url:"/api/article/".concat(t)})}static async getArticleTimeline(){return await i["a"].get({url:"/api/pub/articles/timeline"})}static async getHotArticles(){return await i["a"].get({url:"/api/pub/articles/hot"})}}},fc7b:function(t,e,a){}}]);
//# sourceMappingURL=chunk-11e4d056.724b5718.js.map