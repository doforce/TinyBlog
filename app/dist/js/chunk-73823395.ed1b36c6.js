(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-73823395"],{2720:function(t,e,a){"use strict";var n=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"comment-form"},[a("a-comment",[a("a-avatar",{attrs:{slot:"avatar",src:t.userAvatar,alt:"Han Solo"},slot:"avatar"}),a("div",{attrs:{slot:"content"},slot:"content"},[a("a-form-item",[a("a-textarea",{attrs:{placeholder:"内容",rows:4,value:t.content},on:{change:t.handleChangeContent}})],1),a("a-form-item",[a("a-button",{attrs:{htmlType:"submit",loading:t.submitting,type:"primary"},on:{click:t.submitForm}},[t._v("添加评论")])],1)],1)],1)],1)},s=[],i=a("c722"),r=a("f8b7"),o=a("b70e"),l=a.n(o),c=a("93d6"),m=a("c0d6"),d={name:"SubmitComment",created(){this.token?this.getUser():this.userAvatar=l.a.image.avatar()},data(){return{submitting:!1,content:"",token:m["a"].checkToken(),userAvatar:"",userId:null}},props:{articleId:{required:!0},replyId:{default:void 0}},methods:{getUser(){Object(c["a"])().then(t=>{t.ok&&(this.userAvatar=t.data.avatar,this.userId=t.data.id)})},submitForm(){if(!this.content)return void this.$message.info("请填写完整昵称和内容");this.submitting=!0;let t={article_id:parseInt(this.articleId),avatar:this.userAvatar,content:this.content};this.replyId&&(t.reply_id=this.replyId),this.userId&&(t.user_id=this.userId),i["a"].addComment(t).then(t=>{if(this.submitting=!1,t.ok)return this.$message.success("评论成功"),this.resetForm(),void r["a"].$emit("onAddCommentSuc");this.$message.error("评论失败")})},resetForm(){this.nickname="",this.content=""},handleChangeContent(t){this.content=t.target.value},handleChangeNickname(t){this.nickname=t.target.value}}},u=d,h=(a("86b3"),a("5511")),p=Object(h["a"])(u,n,s,!1,null,"39b878b6",null);e["a"]=p.exports},"5c27":function(t,e,a){},"5d03":function(t,e,a){"use strict";var n=a("c731"),s=a.n(n);s.a},"62a9":function(t,e,a){"use strict";a.r(e);var n=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("a-drawer",{attrs:{title:"回复",width:480,visible:t.replyVisible,placement:"left"},on:{close:t.onClose}},[a("SubmitComment",{attrs:{articleId:t.commentArticleId,replyId:t.replyId}})],1),t.more?a("CustomDatePick",{staticClass:"date-pick"}):t._e(),t.allComments.length>0?a("a-list",{attrs:{itemLayout:"horizontal",dataSource:t.displayComments},scopedSlots:t._u([{key:"renderItem",fn:function(e){return a("a-list-item",{},[a("a-comment",{attrs:{avatar:e.avatar}},[a("p",{attrs:{slot:"content"},slot:"content"},[t._v(t._s(e.content))]),e.user_id?a("a",{attrs:{slot:"author"},slot:"author"},[t._v("作者")]):t._e(),t.replyComments.filter((function(t){return t.reply_id===e.id})).length>0?a("a-collapse",{attrs:{bordered:!1},scopedSlots:t._u([{key:"expandIcon",fn:function(t){return[a("a-icon",{attrs:{type:"caret-right",rotate:t.isActive?90:0}})]}}],null,!0)},[a("a-collapse-panel",{staticClass:"collapse-panel-style",attrs:{header:"查看回复"}},t._l(t.replyComments.filter((function(t){return t.reply_id===e.id})),(function(e){return a("a-comment",{key:"reply_"+e.reply_id,attrs:{avatar:e.avatar}},[a("p",{attrs:{slot:"content"},slot:"content"},[t._v(t._s(e.content))]),e.user_id?a("a",{attrs:{slot:"author"},slot:"author"},[t._v("作者")]):t._e(),a("template",{staticClass:"actions",slot:"actions"},[a("span",[t.more?a("a-tooltip",{staticClass:"action-item",attrs:{title:"删除"}},[a("a-icon",{attrs:{type:"delete"},on:{click:function(a){return t.actionClick("delete",e.id)}}})],1):t._e()],1)]),a("a-tooltip",{attrs:{slot:"datetime",title:t.moment(e.created_at).format("YYYY-MM-DD HH:mm")},slot:"datetime"},[a("span",[t._v(t._s(t.moment(e.created_at).fromNow()))])])],2)})),1)],1):t._e(),a("template",{staticClass:"actions",slot:"actions"},[a("span",[t.more?a("a",{staticClass:"action-item",attrs:{target:"_blank",href:"/post/".concat(e.article_id)}},[t._v(t._s(e.article_title))]):t._e()]),a("span",[t.more?a("a-tooltip",{staticClass:"action-item",attrs:{title:"删除"}},[a("a-icon",{attrs:{type:"delete"},on:{click:function(a){return t.actionClick("delete",e.id)}}})],1):t._e()],1),a("span",{staticClass:"action-item",on:{click:function(a){return t.actionClick("reply",e.id,e.article_id)}}},[t._v("回复")])]),a("a-tooltip",{attrs:{slot:"datetime",title:t.moment(e.created_at).format("YYYY-MM-DD HH:mm")},slot:"datetime"},[a("span",[t._v(t._s(t.moment(e.created_at).fromNow()))])])],2)],1)}}],null,!1,4010910256)}):t._e(),t.allComments.length>t.pageSize?a("a-pagination",{staticClass:"comment-page",attrs:{pageSize:t.pageSize,defaultCurrent:t.currentPage,total:t.allComments.length},on:{"update:pageSize":function(e){t.pageSize=e},"update:page-size":function(e){t.pageSize=e},change:t.handleCurrentChange}}):t._e()],1)},s=[],i=a("c722"),r=a("f8b7"),o=a("6bf2"),l=a.n(o),c=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("a-range-picker",{attrs:{ranges:t.ranges,format:"YYYY-MM-DD"},on:{change:t.onChange}})],1)},m=[],d={name:"CustomDatePick",data(){return{moment:l.a,ranges:{"昨天":[l()().subtract(1,"days"),l()().subtract(1,"days")],"今天":[l()(),l()()],"本周":[l()().startOf("week"),l()().endOf("week")],"上周":[l()().startOf("week").subtract(7,"days"),l()().endOf("week").subtract(7,"days")],"本月":[l()().startOf("month"),l()()],"上月":[l()().subtract(1,"months").startOf("month"),l()().subtract(1,"months").endOf("month")],"今年":[l()().startOf("year"),l()()],"去年":[l()().subtract(1,"years").startOf("year"),l()().subtract(1,"years").endOf("year")]}}},methods:{onChange(t,e){r["a"].$emit("onDatePickChange",e)}}},u=d,h=a("5511"),p=Object(h["a"])(u,c,m,!1,null,"bedac756",null),g=p.exports,C=a("2720");const f="1970-01-01",y=l()().add(1,"day").format("YYYY-MM-DD");var _={name:"Comments",async created(){this.getComments()},components:{CustomDatePick:g,SubmitComment:C["a"]},data(){return{allComments:[],replyComments:[],currentPage:1,pageSize:10,moment:l.a,more:"comments"===this.$route.name,timeStart:f,timeEnd:y,loading:!0,replyVisible:!1,commentArticleId:0,replyId:0}},props:["articleId"],computed:{displayComments:function(){let t=(this.currentPage-1)*this.pageSize,e=this.allComments.length%this.pageSize,a=0===e||t+this.pageSize<this.allComments.length?t+this.pageSize:t+e;return this.allComments.slice(t,a)}},mounted(){r["a"].$on("onAddCommentSuc",()=>{this.replyVisible=!1,this.getComments()}),r["a"].$on("onDatePickChange",t=>{""===t[0]&&""===t[1]?(this.timeStart=f,this.timeEnd=y):(this.timeStart=t[0],this.timeEnd=t[1]),this.getComments()})},methods:{handleCurrentChange(t){this.currentPage=t},getComments(){this.loading=!0,this.articleId?i["a"].getArticleComments(this.articleId).then(e=>t(e)):i["a"].getComments(this.timeStart,this.timeEnd).then(e=>t(e));let t=t=>{if(t.ok){let e=t.data;this.allComments=e.filter(t=>!t.reply_id),this.replyComments=e.filter(t=>t.reply_id)}else this.allComments=[],this.replyComments=[];this.loading=!1}},actionClick(t,e,a){let n=this;"delete"===t?this.$confirm({title:"确认删除这条评论吗？",onOk(){i["a"].deleteComment(e).then(t=>{t.ok?(n.getComments(),n.$message.success("删除成功")):n.$message.success("删除失败")})},onCancel(){}}):"reply"===t&&(this.replyVisible=!0,this.commentArticleId=a,this.replyId=e)},onClose(){this.replyVisible=!1}}},b=_,v=(a("5d03"),Object(h["a"])(b,n,s,!1,null,"911e4ba4",null));e["default"]=v.exports},"86b3":function(t,e,a){"use strict";var n=a("5c27"),s=a.n(n);s.a},c722:function(t,e,a){"use strict";a.d(e,"a",(function(){return s}));var n=a("0dcc");class s{static async addComment(t){let e={url:"/api/pub/comment",data:t};return await n["a"].post(e)}static async getArticleComments(t){let e={url:`/api/pub/article/${t}/comments`};return await n["a"].get(e)}static async deleteComment(t){return await n["a"].delete({url:"/api/comment/".concat(t)})}static async getComments(t,e){return await n["a"].get({url:"/api/pub/comment/list",data:{time_start:t,time_end:e}})}}},c731:function(t,e,a){},f8b7:function(t,e,a){"use strict";var n=a("0261");const s=new n["default"];e["a"]=s}}]);
//# sourceMappingURL=chunk-73823395.ed1b36c6.js.map