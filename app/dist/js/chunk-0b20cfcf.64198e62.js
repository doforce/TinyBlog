(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-0b20cfcf","chunk-73823395"],{2720:function(t,e,a){"use strict";var i=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"comment-form"},[a("a-comment",[a("a-avatar",{attrs:{slot:"avatar",src:t.userAvatar,alt:"Han Solo"},slot:"avatar"}),a("div",{attrs:{slot:"content"},slot:"content"},[a("a-form-item",[a("a-textarea",{attrs:{placeholder:"内容",rows:4,value:t.content},on:{change:t.handleChangeContent}})],1),a("a-form-item",[a("a-button",{attrs:{htmlType:"submit",loading:t.submitting,type:"primary"},on:{click:t.submitForm}},[t._v("添加评论")])],1)],1)],1)],1)},s=[],n=a("c722"),r=a("f8b7"),l=a("b70e"),c=a.n(l),o=a("93d6"),m=a("c0d6"),d={name:"SubmitComment",created(){this.token?this.getUser():this.userAvatar=c.a.image.avatar()},data(){return{submitting:!1,content:"",token:m["a"].checkToken(),userAvatar:"",userId:null}},props:{articleId:{required:!0},replyId:{default:void 0}},methods:{getUser(){Object(o["a"])().then(t=>{t.ok&&(this.userAvatar=t.data.avatar,this.userId=t.data.id)})},submitForm(){if(!this.content)return void this.$message.info("请填写完整昵称和内容");this.submitting=!0;let t={article_id:parseInt(this.articleId),avatar:this.userAvatar,content:this.content};this.replyId&&(t.reply_id=this.replyId),this.userId&&(t.user_id=this.userId),n["a"].addComment(t).then(t=>{if(this.submitting=!1,t.ok)return this.$message.success("评论成功"),this.resetForm(),void r["a"].$emit("onAddCommentSuc");this.$message.error("评论失败")})},resetForm(){this.nickname="",this.content=""},handleChangeContent(t){this.content=t.target.value},handleChangeNickname(t){this.nickname=t.target.value}}},u=d,p=(a("86b3"),a("5511")),h=Object(p["a"])(u,i,s,!1,null,"39b878b6",null);e["a"]=h.exports},"37d3":function(t,e,a){"use strict";a.r(e);var i=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("a-layout",[a("a-layout",[a("a-layout-content",{staticClass:"content"},[a("a-list",{staticClass:"article",attrs:{itemLayout:"vertical",size:"large",split:!1}},[a("a-list-item",[a("template",{slot:"actions"},[a("span",[a("a-icon",{staticStyle:{"margin-right":"8px"},attrs:{type:"eye"}}),t._v(" "+t._s(t.article.views)+" ")],1),a("span",[a("a-icon",{staticStyle:{"margin-right":"8px"},attrs:{type:"message"}}),t._v(" "+t._s(t.article.comment_count)+" ")],1),a("span",[a("a-icon",{staticStyle:{"margin-right":"8px"},attrs:{type:"calendar"}}),t._v(" "+t._s(t.moment(t.article.created_at).format("YYYY年MM月DD日"))+" ")],1),t.more?a("ArticleMore",{attrs:{articleId:t.articleId}}):t._e()],1),a("a-list-item-meta",[a("h1",{attrs:{slot:"title"},slot:"title"},[t._v(t._s(t.article.title))])]),t.article.labels&&t.article.labels.length>0?a("div",t._l(t.article.labels,(function(e){return a("a-tag",{key:e.id,attrs:{color:"blue"}},[t._v(t._s(e.label))])})),1):t._e()],2),a("div",{staticClass:"article-detail"},[a("mavon-editor",{staticClass:"md center",attrs:{ishljs:t.mdSetting.heightLight,value:t.article.content,subfield:t.mdSetting.subfield,defaultOpen:t.mdSetting.defaultOpen,toolbarsFlag:t.mdSetting.toolbarsFlag,editable:t.mdSetting.editable,scrollStyle:t.mdSetting.scrollStyle}})],1),a("SubmitComment",{attrs:{articleId:t.articleId}}),a("Comments",{staticClass:"article-comments",attrs:{articleId:t.articleId}})],1)],1)],1)],1)],1)},s=[],n=a("d8d4"),r=a("62a9"),l=a("f424"),c=a("2720"),o=a("f8b7"),m=a("6bf2"),d=a.n(m),u=a("c0d6"),p={name:"Post",components:{Comments:r["default"],ArticleMore:l["a"],SubmitComment:c["a"]},async created(){await this.getArticle()},mounted(){o["a"].$on("onArticleDeleted",()=>{window.location.href="/"})},data(){return{articleId:this.$route.params.id,article:{},articleList:[],isNotFound:!1,mdSetting:{subfield:!1,defaultOpen:"preview",editable:!1,toolbarsFlag:!1,scrollStyle:!0,heightLight:!0},more:u["a"].checkToken(),moment:d.a}},methods:{async getArticle(){let t=await n["a"].getArticle(this.articleId);t.ok?(this.article=t.data,this.articleList=[this.article]):this.isNotFound=!0}}},h=p,g=(a("f29a"),a("5511")),f=Object(g["a"])(h,i,s,!1,null,"53079d18",null);e["default"]=f.exports},"5c27":function(t,e,a){},"5d03":function(t,e,a){"use strict";var i=a("c731"),s=a.n(i);s.a},"62a9":function(t,e,a){"use strict";a.r(e);var i=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("a-drawer",{attrs:{title:"回复",width:480,visible:t.replyVisible,placement:"left"},on:{close:t.onClose}},[a("SubmitComment",{attrs:{articleId:t.commentArticleId,replyId:t.replyId}})],1),t.more?a("CustomDatePick",{staticClass:"date-pick"}):t._e(),t.allComments.length>0?a("a-list",{attrs:{itemLayout:"horizontal",dataSource:t.displayComments},scopedSlots:t._u([{key:"renderItem",fn:function(e){return a("a-list-item",{},[a("a-comment",{attrs:{avatar:e.avatar}},[a("p",{attrs:{slot:"content"},slot:"content"},[t._v(t._s(e.content))]),e.user_id?a("a",{attrs:{slot:"author"},slot:"author"},[t._v("作者")]):t._e(),t.replyComments.filter((function(t){return t.reply_id===e.id})).length>0?a("a-collapse",{attrs:{bordered:!1},scopedSlots:t._u([{key:"expandIcon",fn:function(t){return[a("a-icon",{attrs:{type:"caret-right",rotate:t.isActive?90:0}})]}}],null,!0)},[a("a-collapse-panel",{staticClass:"collapse-panel-style",attrs:{header:"查看回复"}},t._l(t.replyComments.filter((function(t){return t.reply_id===e.id})),(function(e){return a("a-comment",{key:"reply_"+e.reply_id,attrs:{avatar:e.avatar}},[a("p",{attrs:{slot:"content"},slot:"content"},[t._v(t._s(e.content))]),e.user_id?a("a",{attrs:{slot:"author"},slot:"author"},[t._v("作者")]):t._e(),a("template",{staticClass:"actions",slot:"actions"},[a("span",[t.more?a("a-tooltip",{staticClass:"action-item",attrs:{title:"删除"}},[a("a-icon",{attrs:{type:"delete"},on:{click:function(a){return t.actionClick("delete",e.id)}}})],1):t._e()],1)]),a("a-tooltip",{attrs:{slot:"datetime",title:t.moment(e.created_at).format("YYYY-MM-DD HH:mm")},slot:"datetime"},[a("span",[t._v(t._s(t.moment(e.created_at).fromNow()))])])],2)})),1)],1):t._e(),a("template",{staticClass:"actions",slot:"actions"},[a("span",[t.more?a("a",{staticClass:"action-item",attrs:{target:"_blank",href:"/post/".concat(e.article_id)}},[t._v(t._s(e.article_title))]):t._e()]),a("span",[t.more?a("a-tooltip",{staticClass:"action-item",attrs:{title:"删除"}},[a("a-icon",{attrs:{type:"delete"},on:{click:function(a){return t.actionClick("delete",e.id)}}})],1):t._e()],1),a("span",{staticClass:"action-item",on:{click:function(a){return t.actionClick("reply",e.id,e.article_id)}}},[t._v("回复")])]),a("a-tooltip",{attrs:{slot:"datetime",title:t.moment(e.created_at).format("YYYY-MM-DD HH:mm")},slot:"datetime"},[a("span",[t._v(t._s(t.moment(e.created_at).fromNow()))])])],2)],1)}}],null,!1,4010910256)}):t._e(),t.allComments.length>t.pageSize?a("a-pagination",{staticClass:"comment-page",attrs:{pageSize:t.pageSize,defaultCurrent:t.currentPage,total:t.allComments.length},on:{"update:pageSize":function(e){t.pageSize=e},"update:page-size":function(e){t.pageSize=e},change:t.handleCurrentChange}}):t._e()],1)},s=[],n=a("c722"),r=a("f8b7"),l=a("6bf2"),c=a.n(l),o=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("a-range-picker",{attrs:{ranges:t.ranges,format:"YYYY-MM-DD"},on:{change:t.onChange}})],1)},m=[],d={name:"CustomDatePick",data(){return{moment:c.a,ranges:{"昨天":[c()().subtract(1,"days"),c()().subtract(1,"days")],"今天":[c()(),c()()],"本周":[c()().startOf("week"),c()().endOf("week")],"上周":[c()().startOf("week").subtract(7,"days"),c()().endOf("week").subtract(7,"days")],"本月":[c()().startOf("month"),c()()],"上月":[c()().subtract(1,"months").startOf("month"),c()().subtract(1,"months").endOf("month")],"今年":[c()().startOf("year"),c()()],"去年":[c()().subtract(1,"years").startOf("year"),c()().subtract(1,"years").endOf("year")]}}},methods:{onChange(t,e){r["a"].$emit("onDatePickChange",e)}}},u=d,p=a("5511"),h=Object(p["a"])(u,o,m,!1,null,"bedac756",null),g=h.exports,f=a("2720");const y="1970-01-01",C=c()().add(1,"day").format("YYYY-MM-DD");var b={name:"Comments",async created(){this.getComments()},components:{CustomDatePick:g,SubmitComment:f["a"]},data(){return{allComments:[],replyComments:[],currentPage:1,pageSize:10,moment:c.a,more:"comments"===this.$route.name,timeStart:y,timeEnd:C,loading:!0,replyVisible:!1,commentArticleId:0,replyId:0}},props:["articleId"],computed:{displayComments:function(){let t=(this.currentPage-1)*this.pageSize,e=this.allComments.length%this.pageSize,a=0===e||t+this.pageSize<this.allComments.length?t+this.pageSize:t+e;return this.allComments.slice(t,a)}},mounted(){r["a"].$on("onAddCommentSuc",()=>{this.replyVisible=!1,this.getComments()}),r["a"].$on("onDatePickChange",t=>{""===t[0]&&""===t[1]?(this.timeStart=y,this.timeEnd=C):(this.timeStart=t[0],this.timeEnd=t[1]),this.getComments()})},methods:{handleCurrentChange(t){this.currentPage=t},getComments(){this.loading=!0,this.articleId?n["a"].getArticleComments(this.articleId).then(e=>t(e)):n["a"].getComments(this.timeStart,this.timeEnd).then(e=>t(e));let t=t=>{if(t.ok){let e=t.data;this.allComments=e.filter(t=>!t.reply_id),this.replyComments=e.filter(t=>t.reply_id)}else this.allComments=[],this.replyComments=[];this.loading=!1}},actionClick(t,e,a){let i=this;"delete"===t?this.$confirm({title:"确认删除这条评论吗？",onOk(){n["a"].deleteComment(e).then(t=>{t.ok?(i.getComments(),i.$message.success("删除成功")):i.$message.success("删除失败")})},onCancel(){}}):"reply"===t&&(this.replyVisible=!0,this.commentArticleId=a,this.replyId=e)},onClose(){this.replyVisible=!1}}},_=b,v=(a("5d03"),Object(p["a"])(_,i,s,!1,null,"911e4ba4",null));e["default"]=v.exports},"86b3":function(t,e,a){"use strict";var i=a("5c27"),s=a.n(i);s.a},c722:function(t,e,a){"use strict";a.d(e,"a",(function(){return s}));var i=a("0dcc");class s{static async addComment(t){let e={url:"/api/pub/comment",data:t};return await i["a"].post(e)}static async getArticleComments(t){let e={url:`/api/pub/article/${t}/comments`};return await i["a"].get(e)}static async deleteComment(t){return await i["a"].delete({url:"/api/comment/".concat(t)})}static async getComments(t,e){return await i["a"].get({url:"/api/pub/comment/list",data:{time_start:t,time_end:e}})}}},c731:function(t,e,a){},cf48:function(t,e,a){},d8d4:function(t,e,a){"use strict";a.d(e,"a",(function(){return s}));var i=a("0dcc");class s{static async addArticle(t){let e={url:"/api/article",data:t};return await i["a"].post(e)}static async updateArticle(t,e){let a={url:"/api/article/".concat(t),data:e};return await i["a"].put(a)}static async getArticle(t){let e={url:"/api/pub/article/".concat(t)};return await i["a"].get(e)}static async getArticleList(t){let e=null;return e=t?{url:"/api/pub/articles/list",data:{label_id:t}}:{url:"/api/pub/articles/list"},await i["a"].get(e)}static async deleteArticle(t){return await i["a"].delete({url:"/api/article/".concat(t)})}static async getArticleTimeline(){return await i["a"].get({url:"/api/pub/articles/timeline"})}static async getHotArticles(){return await i["a"].get({url:"/api/pub/articles/hot"})}}},f29a:function(t,e,a){"use strict";var i=a("cf48"),s=a.n(i);s.a},f424:function(t,e,a){"use strict";var i=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("span",{on:{click:t.confirmEdit}},[a("a-icon",{staticStyle:{"margin-right":"8px"},attrs:{type:"edit"}})],1),a("span",[a("a-popconfirm",{attrs:{title:"确认删除此文章吗",okText:"确认",cancelText:"取消"},on:{confirm:t.confirmDelete}},[a("span",[a("a-icon",{staticStyle:{"margin-right":"8px"},attrs:{type:"delete"}})],1)])],1)])},s=[],n=a("d8d4"),r=a("f8b7"),l={name:"ArticleMore",props:["articleId"],methods:{confirmDelete(){n["a"].deleteArticle(this.articleId).then(t=>{t.ok?(r["a"].$emit("onArticleDeleted"),this.$message.success("删除成功")):this.$message.error("删除失败")})},confirmEdit(){window.location.href="/admin/editor/edit/".concat(this.articleId)}}},c=l,o=a("5511"),m=Object(o["a"])(c,i,s,!1,null,"7d37dd43",null);e["a"]=m.exports},f8b7:function(t,e,a){"use strict";var i=a("0261");const s=new i["default"];e["a"]=s}}]);
//# sourceMappingURL=chunk-0b20cfcf.64198e62.js.map