(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-2c4749e0"],{2797:function(e,a,t){},"4ef5":function(e,a,t){"use strict";t.r(a);var r=function(){var e=this,a=e.$createElement,t=e._self._c||a;return t("div",[t("a-tabs",{staticClass:"setting-tabs",attrs:{defaultActiveKey:"1"}},[t("a-tab-pane",{key:"1"},[t("span",{attrs:{slot:"tab"},slot:"tab"},[t("a-icon",{attrs:{type:"user"}}),e._v("个人资料 ")],1),t("Profile")],1),t("a-tab-pane",{key:"2"},[t("span",{attrs:{slot:"tab"},slot:"tab"},[t("a-icon",{attrs:{type:"safety"}}),e._v("密码修改 ")],1),t("Password")],1)],1)],1)},s=[],o=function(){var e=this,a=e.$createElement,t=e._self._c||a;return t("div",[t("a-form",{attrs:{form:e.profile}},[t("a-form-item",{attrs:{label:"头像","label-col":e.labelCol,"wrapper-col":e.wrapperCol}},[t("a-avatar",{staticClass:"item",attrs:{size:"large",src:e.avatar,icon:"user"}}),t("a-upload",{staticClass:"upload-btn",attrs:{name:"avatar",listType:"text",showUploadList:!1,action:e.uploadAction,beforeUpload:e.beforeUpload,customRequest:e.customRequest}},[t("a-button",{attrs:{type:"primary",size:"small"}},[t("a-icon",{attrs:{type:"upload"}}),e._v("上传 ")],1)],1)],1),t("a-form-item",{attrs:{label:"昵称","label-col":e.labelCol,"wrapper-col":e.wrapperCol}},[t("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:["nickname"],expression:"['nickname']"}],staticClass:"item"})],1),t("a-form-item",{attrs:{label:"邮箱","label-col":e.labelCol,"wrapper-col":e.wrapperCol}},[t("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:["email",{rules:[{pattern:e.emailPattern,message:"邮箱格式错误"}]}],expression:"['email' ,{ rules: [{pattern: emailPattern , message: '邮箱格式错误' }] }]"}],staticClass:"item"})],1),t("a-form-item",{attrs:{label:"城市","label-col":e.labelCol,"wrapper-col":e.wrapperCol}},[t("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:["city"],expression:"['city']"}],staticClass:"item",attrs:{placeholder:"还没选择城市呢"}})],1),t("a-form-item",{attrs:{label:"性别","label-col":e.labelCol,"wrapper-col":e.wrapperCol}},[t("a-select",{directives:[{name:"decorator",rawName:"v-decorator",value:["gender"],expression:"['gender']"}],staticClass:"item",attrs:{placeholder:"选择性别"},on:{change:e.handleGenderChange}},[t("a-select-option",{attrs:{value:"0"}},[e._v("男")]),t("a-select-option",{attrs:{value:"1"}},[e._v("女")])],1)],1),t("a-form-item",{attrs:{label:"简介","label-col":e.labelCol,"wrapper-col":e.wrapperCol}},[t("a-textarea",{directives:[{name:"decorator",rawName:"v-decorator",value:["summary"],expression:"['summary']"}],staticClass:"item",attrs:{placeholder:"这个人很懒，什么也没写。",autosize:{minRows:3,maxRows:12}}})],1),t("a-form-item",{attrs:{"wrapper-col":{span:12,offset:1}}},[t("a-button",{staticClass:"item",attrs:{type:"primary","html-type":"submit"},on:{click:e.handleSubmit}},[e._v("确认")])],1)],1)],1)},l=[],i=t("0dcc"),n=t("93d6"),c=t("a49b"),d={name:"Profile",data(){return{avatar:"",profile:this.$form.createForm(this,{name:"profile"}),labelCol:{span:1},wrapperCol:{span:6},uploadAction:"/api/file/upload",emailPattern:c["a"].emailPattern,qiniuToken:""}},created(){this.getProfile()},methods:{handleSubmit(){this.profile.validateFields((e,a)=>{if(!e){let e={};Object.keys(a).filter(e=>a[e]).forEach(t=>e[t]=a[t]),this.updateProfile(e)}})},customRequest(e){i["a"].upload(e.file,this.uploadAction).then(e=>{e.ok?this.updateProfile({avatar:`back:3000/${e.data.avatar}`}):this.$message.error("上传失败")})},updateProfile(e){Object(n["c"])(e).then(e=>{if(e.ok)return this.getProfile(),void this.$message.success("更新成功");this.$message.error("更新失败")})},beforeUpload(e){const a="image/jpeg"===e.type;if(!a)return this.$message.error("只接受 JPEG 和 JPG 格式"),!1;const t=e.size/1024/1024<2;return t?a&&t:(this.$message.error("图片大小需在2M以下"),!1)},handleGenderChange(e){this.profile.setFieldsValue({gender:e})},getProfile(){Object(n["a"])().then(e=>{e.ok&&(this.avatar=e.data.avatar,this.profile.setFieldsValue({nickname:e.data.nickname,email:e.data.email,city:e.data.city,gender:e.data.gender.toString(),summary:e.data.summary}))})}}},u=d,p=(t("56b5"),t("5511")),m=Object(p["a"])(u,o,l,!1,null,"cbbd6de4",null),w=m.exports,f=function(){var e=this,a=e.$createElement,t=e._self._c||a;return t("div",[t("a-form",{attrs:{form:e.Password}},[t("a-form-item",{attrs:{"wrapper-col":e.wrapperCol}},[t("a-input-password",{directives:[{name:"decorator",rawName:"v-decorator",value:["oldPwd",{rules:[{required:!0,message:"请输入原密码"}]}],expression:"['oldPwd', { rules: [{ required: true, message: '请输入原密码' }] }]"}],attrs:{placeholder:"旧密码"}})],1),t("a-form-item",{attrs:{"wrapper-col":e.wrapperCol}},[t("a-input-password",{directives:[{name:"decorator",rawName:"v-decorator",value:["newPwd",{rules:[{required:!0,message:"请输入新密码"}]}],expression:"['newPwd', { rules: [{ required: true, message: '请输入新密码' }] }]"}],attrs:{placeholder:"新密码"}})],1),t("a-form-item",{attrs:{"wrapper-col":e.wrapperCol}},[t("a-input-password",{directives:[{name:"decorator",rawName:"v-decorator",value:["surePwd",{rules:[{required:!0,message:"请再次确认新密码"}]}],expression:"['surePwd', { rules: [{ required: true, message: '请再次确认新密码' }] }]"}],attrs:{placeholder:"请确认新密码"}})],1),t("a-form-item",[t("a-button",{attrs:{type:"primary","html-type":"submit"},on:{click:e.handleSubmit}},[e._v("确认")])],1)],1)],1)},b=[],h={name:"Password",data(){return{Password:this.$form.createForm(this,{name:"password"}),wrapperCol:{span:6}}},methods:{handleSubmit(){this.Password.validateFields((e,a)=>{if(!e){if(a.newPwd!=a.surePwd)return void this.$message.info("两次密码不一致");Object(n["d"])({old_pwd:a.oldPwd,new_pwd:a.newPwd}).then(e=>{e.ok?this.$message.success("修改成功"):this.$message.error("原密码错误"),this.Password.setFieldsValue({oldPwd:"",newPwd:"",surePwd:""})})}})}}},v=h,g=Object(p["a"])(v,f,b,!1,null,"2181d682",null),P=g.exports,y={name:"Setting",components:{Profile:w,Password:P},data(){return{}},created(){},methods:{}},C=y,k=Object(p["a"])(C,r,s,!1,null,"78fe0106",null);a["default"]=k.exports},"56b5":function(e,a,t){"use strict";var r=t("2797"),s=t.n(r);s.a},"93d6":function(e,a,t){"use strict";t.d(a,"e",(function(){return s})),t.d(a,"b",(function(){return o})),t.d(a,"a",(function(){return l})),t.d(a,"c",(function(){return i})),t.d(a,"d",(function(){return n}));var r=t("0dcc");async function s(e,a,t){let s={data:{password:e,email:a,avatar:t},url:"/api/pub/register"};return await r["a"].post(s)}async function o(e,a){let t={data:{email:e,password:a},url:"/api/pub/login"};return await r["a"].post(t)}async function l(){let e={url:"/api/user/"};return await r["a"].get(e)}async function i(e){let a={url:"/api/user/",data:e};return await r["a"].put(a)}async function n(e){let a={url:"/api/user/pwd",data:e};return await r["a"].put(a)}},a49b:function(e,a,t){"use strict";a["a"]={qiniuUrl:"http://puh0vyh1l.bkt.clouddn.com/",qiniuUploadUrl:"http://up-z2.qiniu.com",emailPattern:/\w+([-+.]\w+)*@\w+([-.]\w+)*\.\w+([-.]\w+)*/}}}]);
//# sourceMappingURL=chunk-2c4749e0.b1cffec6.js.map